{% extends 'operacion/layout.html.twig' %}
{% block main %}


     <div class="col-md-6">
         <div class="col-md-5">
             <label for="graffechaDesde">Fecha hasta:</label>
         </div>
        <div class="col-md-7">
            <input id="graffechaDesde" type="text" class="datetimepickerWithoutTime form-control" name="graffechaDesde" required>
        </div>
     </div>
     <div class="col-md-6">
         <div class="col-md-5">
             <label for="graffechaHasta">Fecha hasta:</label>
         </div>
         <div class="col-md-7">
             <input id="graffechaHasta" type="text" class="datetimepickerWithoutTime form-control" name="graffechaHasta" required>
         </div>
     </div>


    <div class="col-md-offset-5 col-md-3">
        <button id="graficar" class="btn btn-primary espacio"> Estadistica entre fechas </button>
    </div>

    <div id="loadingGif" class="col-md-12 espacio ">
        <img  class="col-md-offset-6" src="{{ asset('images/ajax-loader.gif') }}" alt="gif-loading">
    </div>
<div id="exampleGRaf" class="col-md-12"></div>


<div id="grafBarra" class="col-md-12"></div>
{#<div id="grafTorta" class="col-12"></div>#}

{% endblock  %}

{% block javascripts %}

    {{ parent() }}

    <script type="application/javascript">
        $(document).ready(function () {
            grafbarra= $("#grafBarra");
            grafbarra.hide();

            btngraficar = $("#graficar");
            fechahasta= $("#graffechaHasta");
            fechadesde= $("#graffechaDesde");

            path1="{{ path('ajax_RerservaXDia') }}";
            path2="{{ path('ajax_servicioXRer') }}";

            global1=null;
            global2=null ;

            function parseDate(str) {
                var mdy = str.split('/');
                return  (mdy[2]+"-"+mdy[1]+"-"+mdy[0]);
            }

            btngraficar.click(function (){

                if(fechahasta.val() && fechadesde.val()){
                     auxhasta=parseDate(fechahasta.val());
                     auxdesde=parseDate(fechadesde.val());
                     graficar(auxhasta,auxdesde);
                }else{
                    alert("debe llenar algun campo");
                }
            });

            function graficar(auxhasta,auxdesde){
                genericoAjax(path1,funcionResXDia,{fechaHasta : auxhasta , fechaDesde : auxdesde});
                genericoAjax(path2,funcionGenerica,{fechaHasta : auxhasta , fechaDesde : auxdesde});

                graficarBarra();

            }
            $('#loadingGif').hide();
            function genericoAjax(url, funcion, parametros) {
                $.ajax({
                    type: 'POST',
                    url: url,
                    async: true,
                    beforeSend: function() {
                        $('#loadingGif').show();
                    },
                    complete: function(){
                        $('#loadingGif').hide();
                    },
                    data: parametros,
                    dataType: "json",
                    success: function(data){
                        funcion(data);
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert("error ajax"+errorThrown)
                    }
                });
            }



            function funcionResXDia(data){
                global1=new Array() ;
                if (data != null) {
                    global1= data;
                }
            }

//
//            function example() {
//                Highcharts.chart('exampleGRaf', {
//                    chart: {
//                        type: 'spline'
//                    },
//                    title: {
//                        text: 'Wind speed during two days'
//                    },
//                    subtitle: {
//                        text: 'May 31 and and June 1, 2015 at two locations in Vik i Sogn, Norway'
//                    },
//                    xAxis: {
//                        type: 'datetime',
//                        labels: {
//                            overflow: 'justify'
//                        }
//                    },
//                    yAxis: {
//                        title: {
//                            text: 'Wind speed (m/s)'
//                        },
//                        minorGridLineWidth: 0,
//                        gridLineWidth: 0,
//                        alternateGridColor: null,
//                        plotBands: [{ // Light air
//                            from: 0.3,
//                            to: 1.5,
//                            color: 'rgba(68, 170, 213, 0.1)',
//                            label: {
//                                text: 'Light air',
//                                style: {
//                                    color: '#606060'
//                                }
//                            }
//                        }, { // Light breeze
//                            from: 1.5,
//                            to: 3.3,
//                            color: 'rgba(0, 0, 0, 0)',
//                            label: {
//                                text: 'Light breeze',
//                                style: {
//                                    color: '#606060'
//                                }
//                            }
//                        }, { // Gentle breeze
//                            from: 3.3,
//                            to: 5.5,
//                            color: 'rgba(68, 170, 213, 0.1)',
//                            label: {
//                                text: 'Gentle breeze',
//                                style: {
//                                    color: '#606060'
//                                }
//                            }
//                        }, { // Moderate breeze
//                            from: 5.5,
//                            to: 8,
//                            color: 'rgba(0, 0, 0, 0)',
//                            label: {
//                                text: 'Moderate breeze',
//                                style: {
//                                    color: '#606060'
//                                }
//                            }
//                        }, { // Fresh breeze
//                            from: 8,
//                            to: 11,
//                            color: 'rgba(68, 170, 213, 0.1)',
//                            label: {
//                                text: 'Fresh breeze',
//                                style: {
//                                    color: '#606060'
//                                }
//                            }
//                        }, { // Strong breeze
//                            from: 11,
//                            to: 14,
//                            color: 'rgba(0, 0, 0, 0)',
//                            label: {
//                                text: 'Strong breeze',
//                                style: {
//                                    color: '#606060'
//                                }
//                            }
//                        }, { // High wind
//                            from: 14,
//                            to: 15,
//                            color: 'rgba(68, 170, 213, 0.1)',
//                            label: {
//                                text: 'High wind',
//                                style: {
//                                    color: '#606060'
//                                }
//                            }
//                        }]
//                    },
//                    tooltip: {
//                        valueSuffix: ' m/s'
//                    },
//                    plotOptions: {
//                        spline: {
//                            lineWidth: 4,
//                            states: {
//                                hover: {
//                                    lineWidth: 5
//                                }
//                            },
//                            marker: {
//                                enabled: false
//                            },
//                            pointInterval: 3600000, // one hour
//                            pointStart: Date.UTC(2015, 4, 31, 0, 0, 0)
//                        }
//                    },
//                    series: [{
//                        name: 'Hestavollane',
//                        data: [0.2, 0.8, 0.8, 0.8, 1, 1.3, 1.5, 2.9, 1.9, 2.6, 1.6, 3, 4, 3.6, 4.5, 4.2, 4.5, 4.5, 4, 3.1, 2.7, 4, 2.7, 2.3, 2.3, 4.1, 7.7, 7.1, 5.6, 6.1, 5.8, 8.6, 7.2, 9, 10.9, 11.5, 11.6, 11.1, 12, 12.3, 10.7, 9.4, 9.8, 9.6, 9.8, 9.5, 8.5, 7.4, 7.6]
//
//                    }, {
//                        name: 'Vik',
//                        data: [0, 0, 0.6, 0.9, 0.8, 0.2, 0, 0, 0, 0.1, 0.6, 0.7, 0.8, 0.6, 0.2, 0, 0.1, 0.3, 0.3, 0, 0.1, 0, 0, 0, 0.2, 0.1, 0, 0.3, 0, 0.1, 0.2, 0.1, 0.3, 0.3, 0, 3.1, 3.1, 2.5, 1.5, 1.9, 2.1, 1, 2.3, 1.9, 1.2, 0.7, 1.3, 0.4, 0.3]
//                    }],
//                    navigation: {
//                        menuItemStyle: {
//                            fontSize: '10px'
//                        }
//                    }
//                });
//
//            }


            function graficarBarra(){

                auxfechaDesde = fechadesde.val().split('-');

                $('#grafBarra').show();
                Highcharts.chart('grafBarra', {
                    chart: {
                        type: 'spline'
                    },
                    title: {
                        text: 'Operaciones por dia'
                    },
                    subtitle: {
                        text: 'Desde '+fechadesde.val()+' hasta '+fechahasta.val()
                    },
                    xAxis: {
                        type: 'datetime',
                        labels: {
                            overflow: 'justify'
                        },
                        dateTimeLabelFormats: {
                            day: '%e/%m'
                        }
                    },
                    tooltip: {
                        valueSuffix: 'Gan/Dia'
                    },
                    plotOptions: {
                        spline: {
                            lineWidth: 4,
                            states: {
                                hover: {
                                    lineWidth: 5
                                }
                            },
                            marker: {
                                enabled: false
                            },
                            pointInterval: 24 * 3600 * 1000, // one hour
                            /*NO ENTIENDO PORQUE LE TENGO Q DESCONDATAR 1 AL MES
                             LE SUMARA 1 DIGITO AL MES??? NO ENTIENDO PORQ
                             */
                            pointStart: Date.UTC(auxfechaDesde[2],auxfechaDesde[1]-1,auxfechaDesde[0])
                        }
                    },
                    series: [{
                        name: 'Reservas/Operaciones',
                        data: global1 //[100,50,30,800,-300,400,500,30] //aca va el arreglo..//
                    }

                    ],
                    navigation: {
                        menuItemStyle: {
                            fontSize: '10px'
                        }
                    }
                });
            }


        });
    </script>

{% endblock %}